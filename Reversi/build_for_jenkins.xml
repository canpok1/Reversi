<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<project basedir="." default="build" name="Reversi">
    <property environment="env"/>

    <property name="ANT_HOME" value="${env.ANT_HOME}"/>
    <property name="FINDBUGS_HOME" value="${env.FINDBUGS_HOME}"/>

    <property name="debuglevel" value="source,lines,vars"/>
    <property name="javac_target" value="1.6"/>
    <property name="javac_source" value="1.6"/>
    <property name="bootclasspath" value="jdk1.6.0/lib/rt.jar" />
    <property name="source_dir" value="src" />
    <property name="class_dir" value="bin" />
    <property name="javadoc_dest_dir" value="javadoc" />
    <property name="jar_dest_dir" value="Reversi" />

    <path id="Reversi.classpath">
        <pathelement location="bin"/>
        <pathelement location="lib/core.jar"/>
    </path>

    <target name="init">
        <mkdir dir="${class_dir}"/>
        <copy includeemptydirs="false" todir="${class_dir}">
            <fileset dir="${source_dir}">
                <exclude name="**/*.launch"/>
                <exclude name="**/*.java"/>
            </fileset>
        </copy>
    </target>

    <!-- クラスファイルを削除 -->
    <target name="clean">
        <delete dir="${class_dir}"/>
    </target>
    <target depends="clean" name="cleanall"/>

    <!-- ビルド -->
    <target name="build" depends="init">
        <echo message="${ant.project.name}: ${ant.file}"/>
        <javac
            debug="true"
            debuglevel="${debuglevel}"
            destdir="${class_dir}"
            source="${javac_source}"
            target="${javac_target}"
            bootclasspath="${bootclasspath}"
            encoding="UTF-8" >
            <src path="${source_dir}"/>
            <classpath refid="Reversi.classpath"/>
        </javac>
    </target>

    <!-- 実行可能なjarを生成 -->
    <target name="create_jar" depends="build">
        <delete dir="tmp"/>
        <mkdir dir="tmp"/>
        <jar basedir="${class_dir}" jarfile="tmp/${jar_dest_dir}/Reversi_GUI.jar">
            <manifest>
                <attribute name="Main-Class" value="main.GuiMain"/>
                <attribute name="Class-Path" value=". Reversi_lib/core.jar"/>
            </manifest>
        </jar>
        <copy file="lib/core.jar" todir="tmp/${jar_dest_dir}/Reversi_lib"/>
        <zip destfile="${jar_dest_dir}.zip"
            basedir="tmp"
            update="true"
        />
        <delete dir="tmp"/>
    </target>

    <!-- ドキュメントを生成 -->
    <target name="javadoc">
        <javadoc sourcepath="${source_dir}"
            encoding="UTF-8"
            destdir="${javadoc_dest_dir}"
            docencoding="UTF-8"
            charset="UTF-8" />
    </target>

    <!-- 静的解析を実行 -->
    <target name="findbugs">
        <taskdef name="findbugs" classname="edu.umd.cs.findbugs.anttask.FindBugsTask" />
        <findbugs home="${FINDBUGS_HOME}"
                  output="xml:withMessages"
                  outputFile="findbugs.xml">
            <sourcePath path="${source_dir}" />
            <class location="${class_dir}" />
        </findbugs>
    </target>
</project>
